import{d as n,o as i,a as s,i as w,f as S,h as d,c as b,e as C,b as L,j as h,A as E,q as j,F as A,l as B,t as c,n as $,k,G as F,w as M,S as V}from"./app-8v8ETHV2.js";import{_ as I}from"./Pagination-BdCl6jSF.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as P,a as G}from"./SummaryCard-BbyE6_9-.js";function Q(a,p){return i(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}const R={class:"overflow-x-auto"},Z={class:"flex justify-between items-center mb-4"},H={class:"relative max-w-xs"},J={class:"relative"},K={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},W=["placeholder"],X={class:"flex space-x-2"},Y={key:0,value:"best_score"},ee={key:1,value:"avg_score"},te={key:2,value:"attempts_count"},se={key:3,value:"last_attempt_date"},re={key:4,value:"percentage"},oe={key:5,value:"completed_at"},ae={key:6,value:"time_spent"},ie={class:"min-w-full divide-y divide-gray-200"},ne={class:"bg-gray-50"},le={key:0,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},de={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ce={key:2,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ue={key:3,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},pe={key:4,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},xe={key:5,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},_e={class:"bg-white divide-y divide-gray-200"},fe={class:"px-6 py-4 whitespace-nowrap"},me={class:"flex items-center"},ge={class:"flex-shrink-0 h-10 w-10"},he={class:"flex items-center justify-center w-10 h-10 bg-blue-500 rounded-full text-white font-semibold uppercase"},ye={class:"ml-4"},ve={class:"text-sm font-medium text-gray-900"},we={class:"text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap"},ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Se={class:"flex items-center"},Ce={class:"w-16 bg-gray-200 rounded-full h-2.5 mr-2"},qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},De={class:"flex items-center"},ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Le={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},je=["onClick"],Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Be={class:"px-6 py-4 whitespace-nowrap"},$e={class:"flex items-center"},Fe={class:"flex-shrink-0 h-10 w-10"},Me={class:"flex items-center justify-center w-10 h-10 bg-blue-500 rounded-full text-white font-semibold uppercase"},Ve={class:"ml-4"},Te={class:"text-sm font-medium text-gray-900"},Ue={class:"text-sm text-gray-500"},Ee={class:"px-6 py-4 whitespace-nowrap"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Oe={class:"flex items-center"},Pe={class:"w-16 bg-gray-200 rounded-full h-2.5 mr-2"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Re={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ze={key:1,class:"text-gray-400"},He=["onClick"],Je={key:0,class:"text-center py-8 text-gray-500"},Ke={__name:"AttemptsTable",props:{attempts:{type:Object,required:!0,validator:a=>Array.isArray(a==null?void 0:a.data)&&a.data.every(p=>"id"in p&&"user"in p&&p.user!==null)},quizId:{type:[Number,String],required:!0,validator:a=>a!=null},grouped:{type:Boolean,default:!0}},setup(a){const p=a,f=w(""),m=w("all"),g=w("best_score"),_=w("desc"),T=S(()=>{var t;if(!((t=p.attempts)!=null&&t.data))return[];const r={};return p.attempts.data.forEach(e=>{var u;if(!((u=e==null?void 0:e.user)!=null&&u.id))return;const o=e.user.id;r[o]||(r[o]={user:e.user,attempts:[],best_score:0,avg_score:0,attempts_count:0,best_attempt:null,last_attempt_date:null}),r[o].attempts.push(e),r[o].attempts_count++;const l=Number(e.percentage)||0;l>r[o].best_score&&(r[o].best_score=l,r[o].best_attempt=e);const x=new Date(e.completed_at);(!r[o].last_attempt_date||x>new Date(r[o].last_attempt_date))&&(r[o].last_attempt_date=e.completed_at)}),Object.keys(r).forEach(e=>{const o=r[e],l=o.attempts.reduce((x,u)=>x+(Number(u.percentage)||0),0);o.avg_score=o.attempts_count>0?l/o.attempts_count:0}),Object.values(r)}),q=S(()=>{let r=[...T.value];if(f.value){const t=f.value.toLowerCase();r=r.filter(e=>{var x,u,y,v;const o=((u=(x=e.user)==null?void 0:x.name)==null?void 0:u.toLowerCase())||"",l=((v=(y=e.user)==null?void 0:y.email)==null?void 0:v.toLowerCase())||"";return o.includes(t)||l.includes(t)})}return m.value!=="all"&&(r=r.filter(t=>m.value==="passed"?t.best_attempt.is_passed:!t.best_attempt.is_passed)),r.sort((t,e)=>{let o,l;switch(g.value){case"best_score":o=t.best_score,l=e.best_score;break;case"avg_score":o=t.avg_score,l=e.avg_score;break;case"attempts_count":o=t.attempts_count,l=e.attempts_count;break;case"last_attempt_date":o=new Date(t.last_attempt_date),l=new Date(e.last_attempt_date);break;default:o=t.best_score,l=e.best_score}return o<l?_.value==="asc"?-1:1:o>l?_.value==="asc"?1:-1:0}),r}),D=S(()=>{var r;return(r=p.attempts)!=null&&r.data?p.attempts.data.filter(t=>{var e,o,l,x;if(!(t!=null&&t.user))return!1;if(f.value){const u=f.value.toLowerCase(),y=((o=(e=t.user)==null?void 0:e.name)==null?void 0:o.toLowerCase())||"",v=((x=(l=t.user)==null?void 0:l.email)==null?void 0:x.toLowerCase())||"";return y.includes(u)||v.includes(u)}return!0}).filter(t=>m.value==="all"?!0:m.value==="passed"?t.is_passed:!t.is_passed).sort((t,e)=>{let o=t[g.value],l=e[g.value];return g.value==="completed_at"&&(o=new Date(o),l=new Date(l)),o<l?_.value==="asc"?-1:1:o>l?_.value==="asc"?1:-1:0}):[]}),U=r=>{if(!r)return"N/A";const t=Math.floor(r/60),e=r%60;return`${t}m ${e}s`},z=r=>{if(!r)return"N/A";const t=new Date(r);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},N=r=>{if(!(r!=null&&r.quiz_id)||!(r!=null&&r.id)){console.error("Missing required parameters for certificate download");return}try{window.open(route("examiner.certificates.download",{quiz:r.quiz_id,attempt:r.id}),"_blank")}catch(t){console.error("Failed to generate certificate URL:",t)}};return(r,t)=>(i(),n("div",R,[s("div",Z,[s("div",H,[t[4]||(t[4]=s("label",{for:"search",class:"sr-only"},"Search",-1)),s("div",J,[s("div",K,[L(h(Q),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),C(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),type:"text",name:"search",id:"search",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:a.grouped?"Search users...":"Search attempts..."},null,8,W),[[E,f.value]])])]),s("div",X,[C(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),class:"block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"},t[5]||(t[5]=[s("option",{value:"all"},"All Statuses",-1),s("option",{value:"passed"},"Passed",-1),s("option",{value:"failed"},"Failed",-1)]),512),[[j,m.value]]),C(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>g.value=e),class:"block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"},[a.grouped?(i(),n("option",Y,"Best Score")):d("",!0),a.grouped?(i(),n("option",ee,"Avg Score")):d("",!0),a.grouped?(i(),n("option",te,"Attempts Count")):d("",!0),a.grouped?(i(),n("option",se,"Last Attempt")):d("",!0),a.grouped?d("",!0):(i(),n("option",re,"Score")),a.grouped?d("",!0):(i(),n("option",oe,"Date")),a.grouped?d("",!0):(i(),n("option",ae,"Duration"))],512),[[j,g.value]]),s("button",{onClick:t[3]||(t[3]=e=>_.value=_.value==="asc"?"desc":"asc"),class:"p-2 rounded-md border border-gray-300 hover:bg-gray-50"},[_.value==="asc"?(i(),b(h(P),{key:0,class:"h-5 w-5 text-gray-400"})):(i(),b(h(G),{key:1,class:"h-5 w-5 text-gray-400"}))])])]),s("table",ie,[s("thead",ne,[s("tr",null,[a.grouped?d("",!0):(i(),n("th",le," Attempt # ")),t[6]||(t[6]=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," User ",-1)),t[7]||(t[7]=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ",-1)),a.grouped?(i(),n("th",de," Best Score ")):d("",!0),a.grouped?(i(),n("th",ce," Avg Score ")):d("",!0),a.grouped?(i(),n("th",ue," Attempts ")):d("",!0),a.grouped?d("",!0):(i(),n("th",pe," Score ")),a.grouped?d("",!0):(i(),n("th",xe," Time Spent ")),t[8]||(t[8]=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date ",-1)),t[9]||(t[9]=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ",-1))])]),s("tbody",_e,[a.grouped?(i(!0),n(A,{key:0},B(q.value,e=>(i(),n("tr",{key:e.user.id},[s("td",fe,[s("div",me,[s("div",ge,[s("div",he,c(e.user.name.split(" ").map(o=>o[0]).join("").substring(0,2)),1)]),s("div",ye,[s("div",ve,c(e.user.name),1),s("div",we,c(e.user.email),1)])])]),s("td",be,[s("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",e.best_attempt.is_passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},c(e.best_attempt.is_passed?"Passed":"Failed"),3)]),s("td",ke,[s("div",Se,[s("div",Ce,[s("div",{class:"bg-blue-600 h-2.5 rounded-full",style:F(`width: ${e.best_score}%`)},null,4)]),k(" "+c(Math.round(e.best_score))+"% ",1)])]),s("td",qe,[s("div",De,c(Math.round(e.avg_score))+"% ",1)]),s("td",ze,c(e.attempts_count),1),s("td",Ne,c(z(e.last_attempt_date)),1),s("td",Le,[L(h(V),{href:r.route("examiner.quizzes.analysis.user",{quiz:a.quizId,user:e.user.id}),class:"text-blue-600 hover:text-blue-900 mr-3"},{default:M(()=>t[10]||(t[10]=[k(" View All ")])),_:2,__:[10]},1032,["href"]),e.best_attempt.is_passed?(i(),n("button",{key:0,onClick:o=>N(e.best_attempt),class:"text-green-600 hover:text-green-900"}," Certificate ",8,je)):d("",!0)])]))),128)):(i(!0),n(A,{key:1},B(D.value,e=>(i(),n("tr",{key:e.id},[s("td",Ae,c(e.id),1),s("td",Be,[s("div",$e,[s("div",Fe,[s("div",Me,c(e.user.name.split(" ").map(o=>o[0]).join("").substring(0,2)),1)]),s("div",Ve,[s("div",Te,c(e.user.name),1),s("div",Ue,c(e.user.email),1)])])]),s("td",Ee,[s("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",e.is_passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},c(e.is_passed?"Passed":"Failed"),3)]),s("td",Ie,[s("div",Oe,[s("div",Pe,[s("div",{class:"bg-blue-600 h-2.5 rounded-full",style:F(`width: ${e.percentage}%`)},null,4)]),k(" "+c(Math.round(e.percentage))+"% ",1)])]),s("td",Ge,c(U(e.time_spent)),1),s("td",Qe,c(z(e.completed_at)),1),s("td",Re,[e.quiz_id?(i(),b(h(V),{key:0,href:r.route("examiner.quiz.attempts.show",{quiz:e.quiz_id,attempt:e.id}),class:"text-blue-600 hover:text-blue-900 mr-3"},{default:M(()=>t[11]||(t[11]=[k(" Details ")])),_:2,__:[11]},1032,["href"])):(i(),n("span",Ze,"N/A")),e.is_passed&&e.quiz_id?(i(),n("button",{key:2,onClick:o=>N(e),class:"text-green-600 hover:text-green-900"}," Certificate ",8,He)):d("",!0)])]))),128))])]),a.grouped&&q.value.length===0||!a.grouped&&D.value.length===0?(i(),n("div",Je," No attempts match your search criteria ")):d("",!0),a.attempts.last_page>1?(i(),b(I,{key:1,links:a.attempts.links,class:"mt-4"},null,8,["links"])):d("",!0)]))}},tt=O(Ke,[["__scopeId","data-v-01797506"]]);export{tt as A};
